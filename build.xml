<project name="JMeter" default="all" basedir=".">
	<!--
	- Initializes properties for other targets
	-->
	<target name="init">
		<property name="build.compiler" value="classic"/>
		<!-- Where the class files should live -->
		<property name="classes.dest.dir" value="bin/classes"/>
		<!-- Where the Sources live -->
		<property name="sources.src.dir" value="src"/>
		<!-- Where the API documentation lives -->
		<property name="docs.api.dest.dir" value="docs/api"/>
		<property name="version" value="_1.5.1"/>
	</target>

	<!--
	- Compiles the source into class files - dumping results into the 
	- bin/clases directory
	-->
	<target name="compile" depends="init">
		<mkdir dir="${classes.dest.dir}"/>
		<javac srcdir="${sources.src.dir}"
        		classpath="${basedir}/lib/junit.jar:${basedir}/lib/xerces.jar"
       			destdir="${classes.dest.dir}"
       			optimize="on">
       			<exclude name="**/*.df*"/>
       			<exclude name="**/*.html"/>
       			<exclude name="**/*.tpr"/>
       			<exclude name="**/*.tws"/>
       			<exclude name="**/make*"/>
       			<exclude name="**/Makefile"/>
       			<exclude name="**/Changelog*"/>
       			<exclude name="**/*.orig"/>
		</javac>
	</target>
	<target name="rmi" depends="compile">
	        <rmic classpath="bin/classes" base="bin/classes" classname="org.apache.jmeter.engine.RemoteJMeterEngineImpl"/>
		<rmic classpath="bin/classes" base="bin/classes" classname="org.apache.jmeter.samplers.RemoteSampleListenerImpl"/>
	</target>

	<!--
	- Generates java-docs
	-->
	<target name="api-docs" depends="init">
		<javadoc
			sourcepath="${sources.src.dir}" 
			destdir="${docs.api.dest.dir}"
			private="yes" author="yes" version="yes"
			doctitle="Apache JMeter APIs Specification"
			footer="Copyright (c) 1998-99 The Java Apache Project" 
			packagenames="org.apache.jmeter.*, 
			org.apache.jmeter.timers.*,
			org.apache.jmeter.visualizers.*,
			org.apache.jmeter.samplers.*,
			org.apache.jmeter.controllers.*,
			org.apache.jmeter.reporters.*,
			org.apache.jmeter.samplers.ftp.*,
			org.apache.jmeter.samplers.http.*,
			org.apache.jmeter.samplers.jdbc.*,
			org.apache.jmeter.threads.*,
			org.apache.jmeter.util.*"/>
	</target>

	<!--
	- Creates the ApacheJMeter.jar file.
	-->
	<target name="package" depends="compile,rmi">
		<copy toDir="${classes.dest.dir}/org/apache/jmeter/images">
		  <fileset dir="${sources.src.dir}/org/apache/jmeter/images"/>
		</copy>
		<jar jarfile="ApacheJMeter.jar" manifest="src/MANIFEST" basedir="${classes.dest.dir}">
		</jar>
	</target>

	<!--
	- Copies the jar file to bin/ and everything else needed to run JMeter
	- from bin/.
	-->
	<target name="install" depends="package">
		<copy file="ApacheJMeter.jar" toFile="bin/ApacheJMeter.jar"/>
		<copy file="src/org/apache/jmeter/jmeter.properties" toFile="bin/jmeter.properties"/>
		<delete file="ApacheJMeter.jar"/>
	</target>

	<!--
	- Another name for install(?)
	-->
	<target name="all" depends="install"/>

	<!--
	- Creates the distribution packages
	-->
	<target name="dist" depends="install">
		<jar jarfile="../ApacheJMeter${version}.jar" basedir="../" includes="jmeter/**" excludes="**/classes/**"/>
		<zip zipfile="../ApacheJMeter${version}.zip" basedir="../" includes="jmeter/**" excludes="**/classes/**"/>
  		<tar tarfile="../ApacheJMeter${version}.tar" basedir="../" excludes="**/classes/**" includes="jmeter/**" />
        <gzip zipfile="$../ApacheJMeter${version}.tar.gz" src="../ApacheJMeter${version}.tar" /> 	
    </target> 

	<!--
	- Deletes old build files.
	-->
	<target name="clean">
		<delete file="bin/ApacheJMeter.jar"/>
		<delete dir="${classes.dest.dir}"/>
	</target>
</project>
